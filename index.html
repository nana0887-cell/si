<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sic Bo - Big/Small</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #0f3d24;
        }

        /* Custom Animations */
        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        .animate-shake {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            80% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-pop-in {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .animate-float-up {
            animation: floatUp 2s ease-out forwards;
        }

        /* Dice Styles */
        .dice-face {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            padding: 6px;
            background: white;
            border-radius: 12px;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }

        .dot {
            background-color: #333;
            border-radius: 50%;
            align-self: center;
            justify-self: center;
            width: 10px;
            height: 10px;
        }

        .dot-red {
            background-color: #d93025;
        }

        /* Dice Dot Positioning */
        .d-1 .dot:nth-child(1) {
            grid-area: 2 / 2;
        }

        .d-2 .dot:nth-child(1) {
            grid-area: 1 / 3;
        }

        .d-2 .dot:nth-child(2) {
            grid-area: 3 / 1;
        }

        .d-3 .dot:nth-child(1) {
            grid-area: 1 / 3;
        }

        .d-3 .dot:nth-child(2) {
            grid-area: 2 / 2;
        }

        .d-3 .dot:nth-child(3) {
            grid-area: 3 / 1;
        }

        .d-4 .dot:nth-child(1) {
            grid-area: 1 / 1;
        }

        .d-4 .dot:nth-child(2) {
            grid-area: 1 / 3;
        }

        .d-4 .dot:nth-child(3) {
            grid-area: 3 / 1;
        }

        .d-4 .dot:nth-child(4) {
            grid-area: 3 / 3;
        }

        .d-5 .dot:nth-child(1) {
            grid-area: 1 / 1;
        }

        .d-5 .dot:nth-child(2) {
            grid-area: 1 / 3;
        }

        .d-5 .dot:nth-child(3) {
            grid-area: 2 / 2;
        }

        .d-5 .dot:nth-child(4) {
            grid-area: 3 / 1;
        }

        .d-5 .dot:nth-child(5) {
            grid-area: 3 / 3;
        }

        .d-6 .dot:nth-child(1) {
            grid-area: 1 / 1;
        }

        .d-6 .dot:nth-child(2) {
            grid-area: 1 / 3;
        }

        .d-6 .dot:nth-child(3) {
            grid-area: 2 / 1;
        }

        .d-6 .dot:nth-child(4) {
            grid-area: 2 / 3;
        }

        .d-6 .dot:nth-child(5) {
            grid-area: 3 / 1;
        }

        .d-6 .dot:nth-child(6) {
            grid-area: 3 / 3;
        }

        /* Felt Texture */
        .felt-bg {
            background-color: #0f3d24;
            background-image: radial-gradient(circle at center, #1a5c38 0%, #0f3d24 100%);
        }
    </style>
</head>

<body class="felt-bg text-white min-h-screen flex items-center justify-center overflow-hidden">
    <div id="root" class="w-full max-w-5xl h-screen max-h-[900px] flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Constants ---
        const PHASES = {
            SHUFFLING: 'SHUFFLING',
            BETTING: 'BETTING',
            REVEAL: 'REVEAL',
            RESET: 'RESET'
        };

        const CHIPS = [2, 5, 20, 50, 100];
        const BET_TIME = 15;
        const RESET_TIME = 5;

        // --- Components ---

        // 1. Dice Component
        const Dice = ({ value }) => {
            const dots = [];
            const isRed = value === 1 || value === 4;
            const dotClass = isRed ? "dot dot-red" : "dot";

            for (let i = 0; i < value; i++) {
                dots.push(<div key={i} className={dotClass}></div>);
            }

            return (
                <div className={`dice-face d-${value} w-16 h-16 md:w-20 md:h-20 bg-white rounded-xl shadow-lg`}>
                    {dots}
                </div>
            );
        };

        // 2. Toast Component
        const Toast = ({ message, type }) => {
            if (!message) return null;
            const bgColor = type === 'error' ? 'bg-red-600' : 'bg-yellow-500';
            const textColor = type === 'error' ? 'text-white' : 'text-black';

            return (
                <div className={`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-8 py-4 rounded-lg shadow-2xl ${bgColor} ${textColor} text-xl font-bold animate-bounce border-2 border-white`}>
                    {message}
                </div>
            );
        };

        // 3. Floating Text Component (Win/Loss)
        const FloatingText = ({ text, type }) => {
            if (!text) return null;
            const colorClass = type === 'win' ? 'text-yellow-400' : 'text-red-500';
            return (
                <div className={`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-full z-40 text-4xl md:text-6xl font-black ${colorClass} drop-shadow-lg animate-float-up pointer-events-none`}>
                    {text}
                </div>
            );
        };

        // 4. Main App Component
        const App = () => {
            // State
            const [gameState, setGameState] = useState(PHASES.SHUFFLING);
            const [dice, setDice] = useState([1, 1, 1]);
            const [balance, setBalance] = useState(1000);
            const [currentBets, setCurrentBets] = useState({ big: 0, small: 0 });
            const [selectedChip, setSelectedChip] = useState(5);
            const [timer, setTimer] = useState(BET_TIME);
            const [toast, setToast] = useState({ msg: '', type: '' });
            const [resultData, setResultData] = useState(null); // { text: "BIG", winAmount: 200 }

            // Refs
            const timerRef = useRef(null);

            // --- Game Loop Logic ---

            // Phase 1: Shuffling
            useEffect(() => {
                if (gameState === PHASES.SHUFFLING) {
                    // Generate dice immediately but keep hidden
                    const d1 = Math.floor(Math.random() * 6) + 1;
                    const d2 = Math.floor(Math.random() * 6) + 1;
                    const d3 = Math.floor(Math.random() * 6) + 1;
                    setDice([d1, d2, d3]);
                    setResultData(null);

                    // Wait 2 seconds then go to Betting
                    const timeout = setTimeout(() => {
                        setGameState(PHASES.BETTING);
                        setTimer(BET_TIME);
                    }, 2000);
                    return () => clearTimeout(timeout);
                }
            }, [gameState]);

            // Phase 2: Betting Timer
            useEffect(() => {
                if (gameState === PHASES.BETTING) {
                    if (timer > 0) {
                        timerRef.current = setTimeout(() => setTimer(t => t - 1), 1000);
                    } else {
                        setGameState(PHASES.REVEAL);
                    }
                    return () => clearTimeout(timerRef.current);
                }
            }, [gameState, timer]);

            // Phase 3: Reveal & Settlement
            useEffect(() => {
                if (gameState === PHASES.REVEAL) {
                    // Calculate Winnings
                    const sum = dice[0] + dice[1] + dice[2];
                    const isLeopard = dice[0] === dice[1] && dice[1] === dice[2];

                    let totalBet = currentBets.big + currentBets.small;
                    let payout = 0;
                    let resultText = "";
                    let resultType = ""; // 'big', 'small', 'leopard'

                    if (isLeopard) {
                        resultText = "Ë±πÂ≠ê (LEOPARD)";
                        resultType = 'leopard';
                        // House wins all Big/Small bets
                    } else {
                        const isSmall = sum >= 4 && sum <= 10;
                        const isBig = sum >= 11 && sum <= 17;

                        if (isSmall) {
                            resultText = "Â∞è (SMALL)";
                            resultType = 'small';
                            if (currentBets.small > 0) payout += currentBets.small * 2;
                        } else {
                            resultText = "Â§ß (BIG)";
                            resultType = 'big';
                            if (currentBets.big > 0) payout += currentBets.big * 2;
                        }
                    }

                    // Net Change Calculation
                    // If I bet 100 and lose: Balance -100 (already deducted). Net change for round display: -100.
                    // If I bet 100 and win: Balance +200. Net change for round display: +100.
                    // However, user requested: "Win: +$200", "Lose: -$100".
                    // This implies showing the Payout vs Loss.
                    // Let's calculate Net Profit/Loss for the display.

                    const netChange = payout - totalBet;

                    // Update Balance
                    if (payout > 0) {
                        setBalance(b => b + payout);
                    }

                    // Set Result Data for Display
                    setResultData({
                        text: resultText,
                        sum: sum,
                        type: resultType,
                        netChange: netChange,
                        payout: payout
                    });

                    // Wait 5 seconds then Reset
                    const timeout = setTimeout(() => {
                        setGameState(PHASES.RESET);
                    }, 5000);

                    return () => clearTimeout(timeout);
                }
            }, [gameState]);

            // Phase 4: Reset
            useEffect(() => {
                if (gameState === PHASES.RESET) {
                    setCurrentBets({ big: 0, small: 0 });
                    setToast({ msg: '', type: '' });
                    setGameState(PHASES.SHUFFLING);
                }
            }, [gameState]);


            // --- Handlers ---

            const showToast = (msg, type = 'error') => {
                setToast({ msg, type });
                if (type === 'error') {
                    setTimeout(() => setToast({ msg: '', type: '' }), 2000);
                }
            };

            const handleBet = (zone) => {
                if (gameState !== PHASES.BETTING) return;

                // Mutual Exclusivity Check
                if (zone === 'big' && currentBets.small > 0) {
                    showToast("‰∏çÂèØÂêåÊôÇ‰∏ãÊ≥®Â§ßÂ∞è (Cannot bet both)", "error");
                    return;
                }
                if (zone === 'small' && currentBets.big > 0) {
                    showToast("‰∏çÂèØÂêåÊôÇ‰∏ãÊ≥®Â§ßÂ∞è (Cannot bet both)", "error");
                    return;
                }

                // Check Balance
                if (balance < selectedChip) {
                    showToast("È§òÈ°ç‰∏çË∂≥ (Insufficient Balance)", "error");
                    return;
                }

                // Place Bet
                setBalance(b => b - selectedChip);
                setCurrentBets(prev => ({
                    ...prev,
                    [zone]: prev[zone] + selectedChip
                }));
            };

            const handleConfirm = () => {
                if (gameState === PHASES.BETTING) {
                    setTimer(0);
                }
            };

            // --- Render Helpers ---

            const getBowlContent = () => {
                if (gameState === PHASES.SHUFFLING) {
                    return (
                        <div className="w-64 h-64 bg-gray-800 rounded-full flex items-center justify-center border-8 border-yellow-600 shadow-2xl animate-shake relative z-10">
                            <span className="text-8xl">üé≤</span>
                        </div>
                    );
                }
                if (gameState === PHASES.BETTING) {
                    return (
                        <div className="w-64 h-64 bg-gray-800 rounded-full flex items-center justify-center border-8 border-yellow-600 shadow-2xl relative z-10">
                            <div className="text-center animate-pulse">
                                <div className="text-4xl mb-2">‚è≥</div>
                                <div className="text-2xl text-yellow-500 font-bold">Ë´ã‰∏ãÊ≥®</div>
                                <div className="text-sm text-yellow-300">Place Bets</div>
                            </div>
                        </div>
                    );
                }
                // Reveal & Reset
                return (
                    <div className="w-64 h-64 bg-gray-800/95 rounded-full flex flex-col items-center justify-center border-8 border-yellow-600 shadow-2xl relative z-10">
                        <div className="flex gap-4 mb-4">
                            {dice.map((d, i) => <Dice key={i} value={d} />)}
                        </div>
                        {resultData && (
                            <div className="text-center animate-pop-in">
                                <div className="text-3xl font-black text-white drop-shadow-md">
                                    {resultData.sum} Èªû
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="flex flex-col h-full w-full select-none relative overflow-hidden">
                    <Toast message={toast.msg} type={toast.type} />

                    {/* Floating Win/Loss Text */}
                    {gameState === PHASES.REVEAL && resultData && resultData.netChange !== 0 && (
                        <FloatingText
                            text={resultData.netChange > 0 ? `+$${resultData.netChange}` : `-$${Math.abs(resultData.netChange)}`}
                            type={resultData.netChange > 0 ? 'win' : 'lose'}
                        />
                    )}

                    {/* Header */}
                    <header className="flex-none flex justify-between items-center p-4 bg-black/40 backdrop-blur-md border-b border-white/10 z-50">
                        <h1 className="text-xl md:text-2xl font-bold text-yellow-400 tracking-wider">SIC BO (È™∞ÂØ∂)</h1>
                        <div className="flex items-center gap-2">
                            <span className="text-gray-300 text-sm md:text-base">È§òÈ°ç (Balance):</span>
                            <span className="text-xl md:text-2xl font-mono text-yellow-400 font-bold">${balance.toLocaleString()}</span>
                        </div>
                    </header>

                    {/* Game Area - Flex Grow to take available space */}
                    <main className="flex-1 flex flex-col items-center justify-center relative w-full overflow-y-auto p-4">

                        {/* Status / Result Banner */}
                        <div className="absolute top-4 z-0 text-center w-full flex items-center justify-center pointer-events-none">
                            {gameState === PHASES.REVEAL && resultData ? (
                                <h2 className={`text-5xl md:text-6xl font-black drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)] animate-pop-in
                                    ${resultData.type === 'big' ? 'text-red-500' : ''}
                                    ${resultData.type === 'small' ? 'text-blue-500' : ''}
                                    ${resultData.type === 'leopard' ? 'text-yellow-400' : ''}
                                `}>
                                    {resultData.text}
                                </h2>
                            ) : (
                                <h2 className="text-2xl md:text-3xl font-bold text-white/80 drop-shadow-md">
                                    {gameState === PHASES.SHUFFLING && "Ê¥óÁâå‰∏≠ (Shuffling)..."}
                                    {gameState === PHASES.BETTING && `‰∏ãÊ≥®ÊôÇÈñì: ${timer}s`}
                                    {gameState === PHASES.RESET && "Ê∫ñÂÇô‰∏ã‰∏ÄÂ±Ä (Next Round)..."}
                                </h2>
                            )}
                        </div>

                        {/* Bowl */}
                        <div className="mt-12 mb-8 transform scale-90 md:scale-100 transition-transform z-10">
                            {getBowlContent()}
                        </div>

                        {/* Betting Board */}
                        <div className="w-full max-w-4xl grid grid-cols-2 gap-4 md:gap-8 px-2 md:px-4 z-10">
                            {/* SMALL Zone */}
                            <button
                                onClick={() => handleBet('small')}
                                disabled={gameState !== PHASES.BETTING || currentBets.big > 0}
                                className={`
                                    relative h-40 md:h-56 rounded-2xl border-4 flex flex-col items-center justify-center transition-all duration-200 group
                                    ${gameState === PHASES.BETTING ? 'hover:bg-white/5 cursor-pointer active:scale-95' : 'cursor-default opacity-80'}
                                    ${currentBets.big > 0 ? 'opacity-30 grayscale' : ''}
                                    ${gameState === PHASES.REVEAL && resultData?.type === 'small' ? 'bg-blue-500/30 border-blue-400 shadow-[0_0_50px_rgba(59,130,246,0.6)] scale-105 z-20' : 'bg-blue-900/40 border-blue-500/50'}
                                `}
                            >
                                <div className="text-5xl md:text-7xl font-black text-blue-200 mb-2 group-hover:text-blue-100">Â∞è</div>
                                <div className="text-xl md:text-3xl text-blue-300 font-bold">SMALL (4-10)</div>
                                {currentBets.small > 0 && (
                                    <div className="absolute top-4 right-4 bg-yellow-500 text-black font-bold rounded-full w-10 h-10 md:w-14 md:h-14 flex items-center justify-center shadow-lg border-2 border-white text-sm md:text-lg">
                                        ${currentBets.small}
                                    </div>
                                )}
                            </button>

                            {/* BIG Zone */}
                            <button
                                onClick={() => handleBet('big')}
                                disabled={gameState !== PHASES.BETTING || currentBets.small > 0}
                                className={`
                                    relative h-40 md:h-56 rounded-2xl border-4 flex flex-col items-center justify-center transition-all duration-200 group
                                    ${gameState === PHASES.BETTING ? 'hover:bg-white/5 cursor-pointer active:scale-95' : 'cursor-default opacity-80'}
                                    ${currentBets.small > 0 ? 'opacity-30 grayscale' : ''}
                                    ${gameState === PHASES.REVEAL && resultData?.type === 'big' ? 'bg-red-500/30 border-red-400 shadow-[0_0_50px_rgba(239,68,68,0.6)] scale-105 z-20' : 'bg-red-900/40 border-red-500/50'}
                                `}
                            >
                                <div className="text-5xl md:text-7xl font-black text-red-200 mb-2 group-hover:text-red-100">Â§ß</div>
                                <div className="text-xl md:text-3xl text-red-300 font-bold">BIG (11-17)</div>
                                {currentBets.big > 0 && (
                                    <div className="absolute top-4 right-4 bg-yellow-500 text-black font-bold rounded-full w-10 h-10 md:w-14 md:h-14 flex items-center justify-center shadow-lg border-2 border-white text-sm md:text-lg">
                                        ${currentBets.big}
                                    </div>
                                )}
                            </button>
                        </div>
                    </main>

                    {/* Control Panel - Fixed at bottom or Flex-none */}
                    <footer className="flex-none bg-black/80 p-4 backdrop-blur-xl border-t border-white/10 w-full z-50 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6">

                            {/* Chips - No scrolling, flex wrap if needed but prefer single line */}
                            <div className="flex items-center justify-center gap-3 md:gap-6">
                                {CHIPS.map(val => (
                                    <button
                                        key={val}
                                        onClick={() => setSelectedChip(val)}
                                        className={`
                                            relative w-14 h-14 md:w-16 md:h-16 rounded-full border-4 flex items-center justify-center font-bold shadow-lg transition-all
                                            ${selectedChip === val ? 'scale-110 -translate-y-2 ring-4 ring-yellow-400 z-10 shadow-yellow-500/50' : 'hover:scale-105 opacity-90 hover:opacity-100'}
                                            ${val === 2 ? 'bg-blue-600 border-blue-300' : ''}
                                            ${val === 5 ? 'bg-red-600 border-red-300' : ''}
                                            ${val === 20 ? 'bg-green-600 border-green-300' : ''}
                                            ${val === 50 ? 'bg-purple-600 border-purple-300' : ''}
                                            ${val === 100 ? 'bg-gray-900 border-yellow-500 text-yellow-500' : ''}
                                        `}
                                    >
                                        <span className="drop-shadow-md">{val}</span>
                                    </button>
                                ))}
                            </div>

                            {/* Actions */}
                            <div className="flex items-center gap-4 w-full md:w-auto justify-center">
                                <div className="flex flex-col w-full md:w-auto gap-1">
                                    <div className="text-xs text-gray-400 text-center">Time Left</div>
                                    <div className="h-4 bg-gray-700 rounded-full w-32 md:w-48 overflow-hidden border border-gray-600 relative">
                                        <div
                                            className="h-full bg-gradient-to-r from-yellow-600 to-yellow-400 transition-all duration-1000 ease-linear"
                                            style={{ width: `${(timer / BET_TIME) * 100}%` }}
                                        ></div>
                                    </div>
                                </div>

                                <button
                                    onClick={handleConfirm}
                                    disabled={gameState !== PHASES.BETTING}
                                    className={`
                                        px-8 py-3 rounded-xl font-bold text-lg shadow-lg transition-all whitespace-nowrap border-b-4 active:border-b-0 active:translate-y-1
                                        ${gameState === PHASES.BETTING
                                            ? 'bg-yellow-500 hover:bg-yellow-400 text-black border-yellow-700'
                                            : 'bg-gray-700 text-gray-500 cursor-not-allowed border-gray-800'}
                                    `}
                                >
                                    Á¢∫ÂÆöÈñãÁâå
                                </button>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>